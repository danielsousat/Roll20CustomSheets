<div class="main-container">

  <!-- Header -->
  <div class="header">

    <div class="logo main-font">
      <h1 data-i18n="game-title">Freedom Mind</h1>
    </div>

    <div class="flex-column grow">

      <div class="header-row">
        <span class="label secondary-font" data-i18n="name">Nome</span>
        <input name="attr_character_name" type="text" title="@{character_name}" />
      </div>

      <div class="header-row">
        <span class="label secondary-font" data-i18n="archetype">Arquétipo</span>
        <input name="attr_archetype" type="text" title="@{archetype}" />
      </div>

    </div>

  </div>

  <!-- Tab navigation -->
  <div class="tab-panel">

    <button type="action" name="act_profile" data-i18n="profile">Perfil</button>
    <button type="action" name="act_journal" data-i18n="journal">Diário</button>
    <button type="action" name="act_configuration" data-i18n="configuration">Configuração</button>

  </div>
  <input type='hidden' class='tabcontrol' name='attr_tabcontrol' value='profile' />

  <!-- Profile Tab -->
  <div class="profiletab">

    <div class="flex-column">
      <span class="box-title main-font" data-i18n="attributes">Atributos</span>

      <div class="attributes-grid">
        <div class="attribute-box">
          <div class="attribute-row-box attribute-main">
            <span class="label secondary-font" data-i18n="physical">Físico</span>
            <input value="0" name="attr_charphysical" type="number" title="@{charphysical}" />
          </div>

          <div class="attribute-row-box attribute-secondary">
            <span class="label secondary-font" data-i18n="healthpoints">Pontos de Vida</span>
            <input disabled="true" value="@{charphysical}+@{charvigor}" name="attr_charhealthpoints" type="number"
              title="@{charhealthpoints}" />
          </div>

          <div class="attribute-row-box attribute-sub">
            <span class="label secondary-font" data-i18n="strength">Força</span>
            <input value="0" name="attr_charstrength" type="number" title="@{charstrength}" />
          </div>

          <div class="attribute-row-box attribute-sub">
            <span class="label secondary-font" data-i18n="vigor">Vigor</span>
            <input value="0" name="attr_charvigor" type="number" title="@{charvigor}" />
          </div>
        </div>

        <div class="attribute-box">
          <div class="attribute-row-box attribute-main">
            <span class="label secondary-font" data-i18n="mind">Mental</span>
            <input value="0" name="attr_charmind" type="number" title="@{charmind}" />
          </div>

          <div class="attribute-row-box attribute-secondary">
            <span class="label secondary-font" data-i18n="spec">Especializações</span>
            <input disabled="true" value="@{charmind}*3" name="attr_charspec" type="number" title="@{charspec}" />
          </div>

          <div class="attribute-row-box attribute-sub">
            <span class="label secondary-font" data-i18n="intelligence">Inteligência</span>
            <input value="0" name="attr_charintelligence" type="number" title="@{charintelligence}" />
          </div>

          <div class="attribute-row-box attribute-sub">
            <span class="label secondary-font" data-i18n="dexterity">Destreza</span>
            <input value="0" name="attr_chardexterity" type="number" title="@{chardexterity}" />
          </div>
        </div>

        <div class="attribute-box">
          <div class="attribute-row-box attribute-main">
            <span class="label secondary-font" data-i18n="social">Social</span>
            <input value="0" name="attr_charsocial" type="number" title="@{charsocial}" />
          </div>

          <div class="attribute-row-box attribute-secondary">
            <span class="label secondary-font" data-i18n="will">Força de Vontade</span>
            <input disabled="true" value="@{charsocial}" name="attr_charwill" type="number" title="@{charwill}" />
          </div>

          <div class="attribute-row-box attribute-sub">
            <span class="label secondary-font" data-i18n="charisma">Charisma</span>
            <input value="0" name="attr_charcharisma" type="number" title="@{charcharisma}" />
          </div>

          <div class="attribute-row-box attribute-sub">
            <span class="label secondary-font" data-i18n="mien">Porte</span>
            <input value="0" name="attr_charmien" type="number" title="@{charmien}" />
          </div>
        </div>

      </div>

    </div>

    <!-- Middle -->
    <div class="middle">

      <!-- Middle column 1-->
      <div class="middle-column">

        <div class="box flex-column">

          <span class="box-title main-font" data-i18n="resources">Recursos</span>

          <div class="resources-grid">
            <div class="attribute-row-box">
              <span class="label secondary-font" data-i18n="adrenaline">Adrenalina</span>
            </div>

            <div class="attribute-row-box">

              <span class="label secondary-font" data-i18n="total">Total</span>
              <input value="0" name="attr_adrenalinetotal" type="number" title="@{adrenalinetotal}" />


              <span class="label secondary-font" data-i18n="used">Usado</span>
              <input value="0" name="attr_adrenalineused" type="number" title="@{adrenalineused}" />

            </div>

            <div class="attribute-row-box">
              <span class="label secondary-font" data-i18n="fatigue">Fadiga</span>
            </div>

            <div class="attribute-row-box">

              <span class="label secondary-font" data-i18n="total">Total</span>
              <input value="0" name="attr_fatiguetotal" type="number" title="@{fatiguetotal}" />


              <span class="label secondary-font" data-i18n="used">Usado</span>
              <input value="0" name="attr_fatigueused" type="number" title="@{fatigueused}" />

            </div>
          </div>

        </div>

        <div class="box flex-column">

          <span class="box-title main-font" data-i18n="specs">Especializações</span>

          <fieldset class="repeating_specs">

            <div class="repeatable-item">

              <div class="repeatable-row">

                <input class="row-item-margin" name="attr_specname" type="text" data-i18n-placeholder="spec"
                  placeholder="Especialização" title="@{specname}" />

                <div class="repeatable-row-box">
                  <span class="label secondary-font" data-i18n="type">Tipo</span>

                  <select class="select row-item-margin" name="attr_spectype" data-i18n-title="type"
                    title="@{spectype}">
                    <option value="none" selected="selected">-</option>
                    <option value="strength" data-i18n="strength">Força</option>
                    <option value="vigor" data-i18n="vigor">Vigor</option>
                    <option value="intelligence" data-i18n="intelligence">Inteligência</option>
                    <option value="dexterity" data-i18n="dexterity">Destreza</option>
                    <option value="charisma" data-i18n="charisma">Carisma</option>
                    <option value="mien" data-i18n="mien">Porte</option>
                  </select>
                </div>
                <input value="0" name="attr_specvalue" type="number" title="@{specvalue}" />
              </div>
            </div>
          </fieldset>
        </div>



        
        

        <div class="box flex-column">

          <span class="box-title main-font" data-i18n="notes">Anotações</span>
          <textarea name="attr_notes" title="@{notes}"></textarea>

        </div>

      </div>

      <!-- Middle column 2 -->
      <div class="middle-column">

        <div class="box flex-column">

          <span class="box-title main-font" data-i18n="vitality">Vitalidade</span>
          
          <div class="vitality-grid">
            <div class="attribute-row-box">
              <span class="label secondary-font" data-i18n="healthy">Saudável</span>
              <input disabled="true" value="@{charhealthpoints}" name="attr_healthytotal" type="number" title="@{healthytotal}" />
            </div>

            <div class="attribute-row-box">
              <span class="label secondary-font" data-i18n="wounded">Ferido -2</span>
              <input disabled="true" value="@{charhealthpoints}" name="attr_woundedtotal" type="number" title="@{woundedtotal}" />
            </div>

            <div class="attribute-row-box">
              <span class="label secondary-font" data-i18n="dying">Moribundo -6</span>
              <input disabled="true" value="@{charhealthpoints}" name="attr_dyingtotal" type="number" title="@{dyingtotal}" />
            </div>

            <div class="attribute-row-box">       
              <span class="label secondary-font" data-i18n="lost">Perdido</span>
              <input value="0" name="attr_healthylost" type="number" title="@{healthylost}" />
            </div>

            <div class="attribute-row-box">
              <span class="label secondary-font" data-i18n="lost">Perdido</span>
              <input value="0" name="attr_woundedlost" type="number" title="@{woundedlost}" />
            </div>

            <div class="attribute-row-box">
              <span class="label secondary-font" data-i18n="lost">Perdido</span>
              <input value="0" name="attr_dyinglost" type="number" title="@{dyinglost}" />
            </div>
          </div>

        </div>

        <div class="box flex-column">

          <span class="box-title main-font" data-i18n="equipments">Equipamentos</span>

          <fieldset class="repeating_equipments">

            <div class="repeatable-item">
              <div class="repeatable-row">
                <input name="attr_equipment" type="text" data-i18n-placeholder="equipment" placeholder="Equipamento" />

                <div class="showhidebutton">
                  <input type="checkbox" name="attr_showhide_checkbox" value="1" />
                  <span></span>
                </div>

              </div>

              <!-- Hidden checkbox that controls show/hide section. See Sheet Workers-->
              <input class="toggle-checkbox" type="checkbox" name="attr_showhide_checkbox_invisible" value="1" />

              <textarea class="showhide" name="attr_equipmentdescription" data-i18n-placeholder="description"
                placeholder="Descrição"></textarea>
            </div>

          </fieldset>

        </div>




        <div class="box flex-column">

          <span class="box-title main-font" data-i18n="weapons">Armas</span>

          <fieldset class="repeating_weapons">

            <div class="repeatable-item">

              <div class="repeatable-row">

                <input class="row-item-margin" name="attr_weaponname" type="text" data-i18n-placeholder="name"
                  placeholder="Nome" />

                <div class="repeatable-row-box">
                  <span class="label secondary-font" data-i18n="damage">Tipo</span>

                  <select class="select row-item-margin" name="attr_weapontype" data-i18n-title="type" title="Tipo">
                    <option value="none" selected="selected">-</option>
                    <option value="light" data-i18n="light">Leve</option>
                    <option value="medium" data-i18n="medium">Média</option>
                    <option value="heavy" data-i18n="heavy">Pesada</option>
                  </select>
                </div>

                <button type="roll" class="roll-button" name="roll_weapon_damage" title="@{weapon_damage}"
                  value="&{template:main} {{charname=@{character_name}}} {{check=@{body}}} {{target=[[15]]}} {{result=[[ ?{ @{advantagedisadvantage} | @{no}, 1d20 | @{advantage}, 2d20kh1 | @{disadvantage}, 2d20kl1 } + @{charbody} ]]}}"></button>

              </div>

              <textarea name="attr_weapondescription" data-i18n-placeholder="description"
                placeholder="Descrição"></textarea>

            </div>
          </fieldset>

        </div>

      </div>

    </div>

  </div>

  <!-- Journal Tab -->
  <div class='journaltab'>
    <h2>Journal/Notes</h2>
    <span>Journal/Notes Stuff Goes here</span>
  </div>

  <!-- Config tab-->
  <div class='configurationtab'>
    <h2>Config/Settings</h2>
    <span>Sheet Config/Settings goes here</span>
  </div>

  <!-- Footer -->
  <div class="footer secondary-font">
    <span data-i18n="copyright">[Nome do jogo] é um jogo escrito por [nome do autor].</span>
  </div>

</div>

<!-- end of sheet -->

<!-- Roll Templates -->
<rolltemplate class="sheet-rolltemplate-main">
  <div class="template-container">
    <div class="template-row template-header template-label secondary-font">
      {{charname}}
    </div>

    {{#action}}
    <div class="template-row">
      <span class="template-label secondary-font">{{action}}</span>
      {{#text}}
      <p>{{text}}</p>
      {{/text}}

    </div>
    {{/action}}

    {{#check}}
    <div class="template-row">
      <span class="template-label secondary-font" data-i18n="check">Teste</span>
      {{check}}
    </div>
    {{/check}}

    {{#result}}

    <div class="template-row">
      <span class="template-label secondary-font" data-i18n="result">Resultado</span>
      {{result}}
    </div>

    {{#^rollLess() result target}}
    <div class="template-row">
      <span class="template-label secondary-font template-success" data-i18n="success">Sucesso!</span>
    </div>
    {{/^rollLess() result target}}

    {{#rollLess() result target}}
    <div class="template-row">
      <span class="template-label secondary-font template-fail" data-i18n="fail">Falha!</span>
    </div>
    {{/rollLess() result target}}


    {{#rollWasCrit() result}}
    <div class="template-row">
      <span class="template-label secondary-font template-success" data-i18n="critic">Sucesso Crítico!</span>
    </div>
    {{/rollWasCrit() result}}

    {{#rollWasFumble() result}}
    <div class="template-row">
      <span class="template-label secondary-font template-fail" data-i18n="fumble">Falha Crítica!</span>
    </div>
    {{/rollWasFumble() result}}

    {{/result}}

  </div>

</rolltemplate>

<!-- Strings translations for Roll Queries-->
<div style="display: none;">
  <span data-i18n="advantagedisadvantage">Possui vantagem ou desvantagem?</span>
  <span data-i18n="no">Não</span>
  <span data-i18n="advantage">Vantagem</span>
  <span data-i18n="disadvantage">Desvantagem</span>
  <span data-i18n="result">Resultado</span>
  <span data-i18n="success">Sucesso!</span>
  <span data-i18n="fail">Falha!</span>
  <span data-i18n="critic">Sucesso Crítico!</span>
  <span data-i18n="fumble">Falha Crítica!</span>
  <span data-i18n="check">Teste</span>
</div>

<!--Sheet Workers -->
<script type="text/worker">

  const buttonlist = ["profile","journal","configuration"];
  
  /*config tabs control */
  buttonlist.forEach(button => {
      on(`clicked:${button}`, function() {
          setAttrs({
              tabcontrol: button
          });
      });
  });

  /*Controls show hide checkbox button from repeating sections*/
  on("change:repeating_equipments:showhide_checkbox" , function(eventInfo) {
    
    let source = eventInfo.sourceAttribute;
    let changeAttributes = new Object();
    let targetId = source + '_invisible';
    
    changeAttributes[targetId] = eventInfo.newValue;

    console.log(eventInfo);
    console.log(changeAttributes);

    setAttrs(changeAttributes);
  });

  /*config Roll Queries translations */
  on("sheet:opened", function(eventInfo){
      
      setAttrs({
          advantagedisadvantage: getTranslationByKey("advantagedisadvantage"),
          no: getTranslationByKey("no"),
          advantage: getTranslationByKey("advantage"),
          disadvantage: getTranslationByKey("disadvantage"),
          result: getTranslationByKey("result"),
          check: getTranslationByKey("check"),
          strength: getTranslationByKey("strength"),
          dexterity: getTranslationByKey("dexterity")
      });     
      
  });

  /*keep attributes values at 13 max*/
  on("change:charbody change:charmind change:charcharisma change:charcuriosity change:charsurvival", function(eventInfo) {  
    const maxValue = 13;
    let oldValue = parseInt(eventInfo.previousValue)||0;
    let newValue = parseInt(eventInfo.newValue)||0;
    let attribute = eventInfo.sourceAttribute;
    let changedAttributes = new Object();
    
    changedAttributes[attribute] = maxValue;
    
    if (newValue > maxValue) {
  
      changedAttributes[attribute] = maxValue;
      setAttrs(changedAttributes);
    }
     
  });

  /*controls roll buttons when char has a condition checked*/
  on("change:wounded change:shaken change:ashamed", function(eventInfo) {  
    const disadvantage = "disadvantage";
    const normal = "normal";
    const sourceAttribute = eventInfo.sourceAttribute;
    const newValue = eventInfo.newValue;
    let changedAttributes = new Object();
    let controlToUpdate = sourceAttribute + "control";
    
    changedAttributes[controlToUpdate] = normal;

    switch(newValue) {
      case "on":
        changedAttributes[controlToUpdate] = disadvantage;
        break;
      default:
        changedAttributes[controlToUpdate] = normal;
    }
    
    setAttrs(changedAttributes);
     
  });
  
  
</script>