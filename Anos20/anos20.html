<div class="main-container">

  <!-- Tab navigation -->
  <div class="tab-panel">

    <input type="radio" name="attr_tabs_radio" value="profile" checked="true" data-i18n-title="profile"
      title="Perfil" />
    <div>U</div>
    <input type="radio" name="attr_tabs_radio" value="configuration" data-i18n-title="configuration"
      title="Configuração" />
    <div>y</div>
    <input type="radio" name="attr_tabs_radio" value="help" data-i18n-title="help" title="Ajuda" />
    <div>?</div>

  </div>
  <input type='hidden' class="tabcontrol" name='attr_selected_tab' value='profile' />

  <!-- Profile Tab -->
  <div class="profiletab">

    <div class="profilegrid">
      <div class="header">
        <span class="passport" data-i18n="passport">passaporte</span>

        <span class="mainlabel" data-i18n="name">Nome:</span>
        <input name="attr_character_name" type="text" title="@{character_name}" />

        <span class="mainlabel" data-i18n="profession">Profissão:</span>
        <input name="attr_profession" type="text" title="@{profession}" />

        <span class="mainlabel" data-i18n="problem">Problema:</span>
        <input name="attr_problem" type="text" title="@{problem}" />
      </div>

      <!--Sanity-->
      <div class="column">
        <span class="box-label" data-i18n="sanity">sanidade</span>

        <div class="sanity">
          <input name="attr_sanity" class="base-radio radio-zero big-radio-zero" type="radio" value="0" title="@{sanity}" /> <span></span>
          <input name="attr_sanity" class="base-radio big-radio sanity-radio" type="radio" value="1" title="@{sanity}" /> <span></span>
          <input name="attr_sanity" class="base-radio big-radio sanity-radio" type="radio" value="2" title="@{sanity}" /> <span></span>
          <input name="attr_sanity" class="base-radio big-radio sanity-radio" type="radio" value="3" title="@{sanity}" /> <span></span>
          <input name="attr_sanity" class="base-radio big-radio sanity-radio" type="radio" value="4" title="@{sanity}" /> <span></span>
          <input name="attr_sanity" class="base-radio big-radio sanity-radio" type="radio" value="5" title="@{sanity}" /> <span></span>
        </div>
      </div>

      <div class="column">

        <!--Profession Description-->
        <div class="column profession">
          <input class="profession-title" type="text" name="attr_professiontitle" title="@{professiontitle}" />
          
          <textarea class="profession-description" name="attr_professiondescription" data-i18n-placeholder="profession-description"
            placeholder="Descrição da Profissão" title="@{professiondescription}"></textarea>

        </div>

        <!--Features-->
        <div class="column features">

          <span class="box-label" data-i18n="features">características</span>

          <fieldset class="repeating_features">

            <div class="repeatable-row">
              <textarea class="feature-description" name="attr_featuredescription" data-i18n-placeholder="feature"
                placeholder="característica" title="@{featuredescription}"></textarea>
              <input name="attr_featuretype" type="hidden" value="0" />
            </div>

          </fieldset>
        </div>
      </div>

      <!--Vitality-->
      <div class="column">
        <span class="box-label" data-i18n="vitality">vitalidade</span>

        <div class="sanity">
          <input name="attr_vitality" class="base-radio radio-zero big-radio-zero" type="radio" value="0" title="@{vitality}" checked="true"/> <span></span>
          <input name="attr_vitality" class="base-radio vitality-radio big-radio" type="radio" value="1" title="@{vitality}" /> <span></span>
          <input name="attr_vitality" class="base-radio vitality-radio big-radio" type="radio" value="2" title="@{vitality}" /> <span></span>
          <input name="attr_vitality" class="base-radio vitality-radio big-radio" type="radio" value="3" title="@{vitality}" /> <span></span>
          <input name="attr_vitality" class="base-radio vitality-radio big-radio" type="radio" value="4" title="@{vitality}" /> <span></span>
          <input name="attr_vitality" class="base-radio vitality-radio big-radio" type="radio" value="5" title="@{vitality}" /> <span></span>
        </div>
      </div>

      <!-- Clothing and Accessories-->
      <div class="equipment">
        <span class="box-label" data-i18n="clothes-and-accessories">vestimenta e acessórios</span>

        <fieldset class="repeating_equipments">

          <div class="repeatable-row">
            <input name="attr_equipment" type="text" title="@{equipment}" />

            <div class="showhidebutton arrowtype">
              <input type="checkbox" name="attr_showhide_checkbox" value="1" />
              <span></span>
            </div>

          </div>

          <!-- Hidden checkbox that controls show/hide section. See Sheet Workers-->
          <input class="toggle-checkbox" type="checkbox" name="attr_showhide_checkbox_invisible" value="1" />

          <textarea class="showhide" name="attr_equipmentdescription" data-i18n-placeholder="description"
            placeholder="Descrição" title="@{equipmentdescription}"></textarea>

        </fieldset>
      </div>

      <!--Money and miscelaneous-->
      <div class="misc">
        <span class="mainlabel" data-i18n="credits">Créditos</span>
        <input name="attr_credits" type="text" title="@{credits}" />

        <span class="mainlabel artist" data-i18n="registered-studio">Atelier Registrado</span>
        <input class="artist" name="attr_studio" type="text" title="@{studio}" />

        <span class="mainlabel artist" data-i18n="art-type">Tipo de Arte</span>
        <input class="artist" name="attr_art" type="text" title="@{art}" />

        <span class="mainlabel studyarea" data-i18n="study-area">Área de Estudo</span>
        <input class="studyarea" name="attr_study_area" type="text" title="@{study_area}" />

        <span class="mainlabel student" data-i18n="study">Estudo</span>
        <span class="mainlabel medic" data-i18n="medical-kit">Kit Médico</span>
        <div class="misc-marker">
          <input name="attr_misc_radio" class="base-radio radio-zero small-radio-zero" type="radio" value="0" title="@{misc_radio}" checked="true" /> <span></span>
          <input name="attr_misc_radio" class="base-radio misc-radio small-radio" type="radio" value="1" title="@{misc_radio}" /> <span></span>
          <input name="attr_misc_radio" class="base-radio misc-radio small-radio" type="radio" value="2" title="@{misc_radio" /> <span></span>
          <input name="attr_misc_radio" class="base-radio misc-radio small-radio" type="radio" value="3" title="@{misc_radio}" /> <span></span>
          <input name="attr_misc_radio" class="base-radio misc-radio small-radio" type="radio" value="4" title="@{misc_radio}" /> <span></span>
          <input name="attr_misc_radio" class="base-radio misc-radio small-radio" type="radio" value="5" title="@{misc_radio}" /> <span></span>
        </div>
        
        <span class="mainlabel shopkeeper" data-i18n="store-name">Nome da Loja</span>
        <input class="shopkeeper" name="attr_store_name" type="text" title="@{store_name}" />

        <span class="mainlabel shopkeeper" data-i18n="commerce-type">Tipo de Comércio</span>
        <input class="shopkeeper" name="attr_commerce_type" type="text" title="@{commerce_type}" />

        <span class="mainlabel police" data-i18n="weapon-type">Tipo de Arma</span>
        <input class="police" name="attr_commerce_type" type="text" title="@{commerce_type}" />

      </div>

      <div class="logo">
        Anos 20
      </div>

      <div class="logo2">
        <span class="box-label" data-i18n="work-for-the-glory-of-the-city">trabalhe pela glória da cidade</span>
      </div>


    </div>
  </div>

  <!-- Config tab-->
  <div class='configurationtab'>
    <h2>Config/Settings</h2>
    <span>Sheet Config/Settings goes here</span>
  </div>

  <!-- Help Tab -->
  <div class='helptab'>
    <h2>Help page</h2>
    <span>Help Stuff Goes here</span>
  </div>

  <!-- Footer -->
  <div class="footer secondary-font">
    <span data-i18n="copyright">Anos 20 é um jogo escrito por Luis Heavy.</span>
  </div>

</div>

<!-- end of sheet -->

<!-- Roll Templates -->
<rolltemplate class="sheet-rolltemplate-main">
  <div class="template-container">
    <div class="template-row template-header template-label secondary-font">
      {{charname}}
    </div>

    {{#action}}
    <div class="template-row">
      <span class="template-label secondary-font">{{action}}</span>
      {{#text}}
      <p>{{text}}</p>
      {{/text}}

    </div>
    {{/action}}

    {{#check}}
    <div class="template-row">
      <span class="template-label secondary-font" data-i18n="check">Teste</span>
      {{check}}
    </div>
    {{/check}}

    {{#result}}

    <div class="template-row">
      <span class="template-label secondary-font" data-i18n="result">Resultado</span>
      {{result}}
    </div>

    {{#^rollLess() result target}}
    <div class="template-row">
      <span class="template-label secondary-font template-success" data-i18n="success">Sucesso!</span>
    </div>
    {{/^rollLess() result target}}

    {{#rollLess() result target}}
    <div class="template-row">
      <span class="template-label secondary-font template-fail" data-i18n="fail">Falha!</span>
    </div>
    {{/rollLess() result target}}


    {{#rollWasCrit() result}}
    <div class="template-row">
      <span class="template-label secondary-font template-success" data-i18n="critic">Sucesso Crítico!</span>
    </div>
    {{/rollWasCrit() result}}

    {{#rollWasFumble() result}}
    <div class="template-row">
      <span class="template-label secondary-font template-fail" data-i18n="fumble">Falha Crítica!</span>
    </div>
    {{/rollWasFumble() result}}

    {{/result}}

  </div>

</rolltemplate>

<!-- Strings translations for Roll Queries-->
<div style="display: none;">
  <span data-i18n="advantagedisadvantage">Possui vantagem ou desvantagem?</span>
  <span data-i18n="no">Não</span>
  <span data-i18n="advantage">Vantagem</span>
  <span data-i18n="disadvantage">Desvantagem</span>
  <span data-i18n="result">Resultado</span>
  <span data-i18n="success">Sucesso!</span>
  <span data-i18n="fail">Falha!</span>
  <span data-i18n="critic">Sucesso Crítico!</span>
  <span data-i18n="fumble">Falha Crítica!</span>
  <span data-i18n="check">Teste</span>
  <span data-i18n="fire-description">Dá 1d6 de dano de fogo.</span>
  <span data-i18n="ice-description">Congela 1d4 inimigos.</span>
</div>

<!--Sheet Workers -->
<script type="text/worker">

  const spellslist = [
    {
      button: 'fire',
      name: getTranslationByKey('fire'),
      description: getTranslationByKey('fire-description')
    },
    
    {
      button: 'ice',
      name: getTranslationByKey('ice'),
      description: getTranslationByKey('ice-description')
    }
  ];
  
  /*Tabs Control */
  on('change:tabs_radio', function(eventInfo) {
    setAttrs({
      selected_tab: eventInfo.newValue
    });
  });

  /*config spells select */
  spellslist.forEach(spell => {
      on(`clicked:${spell.button}`, function() {
        var newrowid = generateRowID();
        var newrowattrs = {};
        newrowattrs["repeating_spells_" + newrowid + "_spell"] = spell.name;
        newrowattrs["repeating_spells_" + newrowid + "_spelldescription"] = spell.description;
        setAttrs(newrowattrs);
      });
  });

  /*Controls show hide checkbox button from repeating sections*/
  on("change:repeating_equipments:showhide_checkbox change:spells_showhide_checkbox" , function(eventInfo) {
    
    let source = eventInfo.sourceAttribute;
    let changeAttributes = new Object();
    let targetId = source + '_invisible';
    
    changeAttributes[targetId] = eventInfo.newValue;

    console.log(eventInfo);
    console.log(changeAttributes);

    setAttrs(changeAttributes);
  });

  /*config Roll Queries translations */
  on("sheet:opened", function(eventInfo){
      
      setAttrs({
          advantagedisadvantage: getTranslationByKey("advantagedisadvantage"),
          no: getTranslationByKey("no"),
          advantage: getTranslationByKey("advantage"),
          disadvantage: getTranslationByKey("disadvantage"),
          result: getTranslationByKey("result"),
          check: getTranslationByKey("check"),
          strength: getTranslationByKey("strength"),
          dexterity: getTranslationByKey("dexterity")
      });     
      
  });

  /*keep attributes values at 13 max*/
  on("change:charbody change:charmind change:charcharisma change:charcuriosity change:charsurvival", function(eventInfo) {  
    const maxValue = 13;
    let oldValue = parseInt(eventInfo.previousValue)||0;
    let newValue = parseInt(eventInfo.newValue)||0;
    let attribute = eventInfo.sourceAttribute;
    let changedAttributes = new Object();
    
    changedAttributes[attribute] = maxValue;
    
    if (newValue > maxValue) {
  
      changedAttributes[attribute] = maxValue;
      setAttrs(changedAttributes);
    }
     
  });

  /*controls roll buttons when char has a condition checked*/
  on("change:wounded change:shaken change:ashamed", function(eventInfo) {  
    const disadvantage = "disadvantage";
    const normal = "normal";
    const sourceAttribute = eventInfo.sourceAttribute;
    const newValue = eventInfo.newValue;
    let changedAttributes = new Object();
    let controlToUpdate = sourceAttribute + "control";
    
    changedAttributes[controlToUpdate] = normal;

    switch(newValue) {
      case "on":
        changedAttributes[controlToUpdate] = disadvantage;
        break;
      default:
        changedAttributes[controlToUpdate] = normal;
    }
    
    setAttrs(changedAttributes);
     
  });
  
  
</script>